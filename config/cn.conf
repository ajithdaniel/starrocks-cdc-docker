# =============================================================================
# StarRocks Compute Node (CN) Configuration - Shared-Data Mode
# =============================================================================

# -----------------------------------------------------------------------------
# Basic Configuration
# -----------------------------------------------------------------------------
LOG_DIR = ${STARROCKS_HOME}/log
sys_log_level = INFO

# Priority networks for internal communication
priority_networks = 172.16.0.0/12;192.168.0.0/16;10.0.0.0/8

# -----------------------------------------------------------------------------
# Port Configuration
# -----------------------------------------------------------------------------
# BE HTTP port
be_http_port = 8040

# BE RPC port
be_port = 9060

# Heartbeat port
heartbeat_service_port = 9050

# BRPC port
brpc_port = 8060

# StarRocks internal port
starlet_port = 9070

# -----------------------------------------------------------------------------
# Storage Configuration
# -----------------------------------------------------------------------------
# Local storage directory (for cache only in shared-data mode)
storage_root_path = ${STARROCKS_HOME}/storage

# -----------------------------------------------------------------------------
# Object Storage / Shared-Data Configuration
# -----------------------------------------------------------------------------
# StarRocks shared-data cache configuration
starlet_cache_dir = ${STARROCKS_HOME}/storage/starlet_cache

# Enable data cache for shared-data queries
starlet_star_cache_disk_size_percent = 80

# -----------------------------------------------------------------------------
# Memory Configuration
# -----------------------------------------------------------------------------
# Memory limit as percentage of total system memory
mem_limit = 80%

# -----------------------------------------------------------------------------
# Compaction Configuration (Critical for CDC workloads)
# -----------------------------------------------------------------------------
# Number of compaction threads
compact_threads = 4

# Update compaction threads per disk
update_compaction_num_threads_per_disk = 2

# Minimum interval between compactions for same tablet
update_compaction_per_tablet_min_interval_seconds = 60

# -----------------------------------------------------------------------------
# Primary Key Table Configuration (Critical for CDC)
# -----------------------------------------------------------------------------
# Max memory for L0 primary key index per tablet (100MB)
l0_max_mem_usage = 104857600

# Skip preloading primary key index (saves memory)
skip_pk_preload = false

# Transaction publish version worker count (for shared-data)
transaction_publish_version_worker_count = 8

# -----------------------------------------------------------------------------
# Query Configuration
# -----------------------------------------------------------------------------
# Enable vectorized engine
enable_vectorized_engine = true

# Parallel scan threads
pipeline_scan_thread_pool_thread_num = 8

# -----------------------------------------------------------------------------
# Load Configuration
# -----------------------------------------------------------------------------
# Load memory limit
load_process_max_memory_limit_percent = 30

# Push write concurrency
push_write_mbytes_per_sec = 100

# Number of threads for loading
routine_load_thread_pool_size = 10

# -----------------------------------------------------------------------------
# Network Configuration
# -----------------------------------------------------------------------------
# Thrift server threads
thrift_server_max_worker_threads = 4096

# BRPC configuration
brpc_num_threads = 256

# -----------------------------------------------------------------------------
# Monitoring
# -----------------------------------------------------------------------------
# Enable metrics for monitoring
enable_metric_calculator = true
